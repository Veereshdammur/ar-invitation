<!DOCTYPE html>
<html>
<head>
    <title>Birthday Invitation AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="styles/main.css">
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.4.0/dist/aframe-master.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium;"
        loading-screen="enabled: false">
        <a-entity
            id="invitation-entity"
            geometry="primitive: plane;"
            material="shader: flat; src: invitation.jpeg; transparent: true; opacity: 1; side: double"
            position="0 0 -1"
            look-at="[camera]"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 15000; easing: linear">
        </a-entity>
        <a-camera position="0 0 0" look-controls-enabled="false"></a-camera>
    </a-scene>

    <div id="loading-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; justify-content: center; align-items: center;">
        <p>Loading Birthday Invitation AR Experience...</p>
    </div>

    <div id="mobile-instructions" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); color: white; padding: 10px 20px; border-radius: 20px; font-family: Arial; display: none; text-align: center;">
        Move your phone around to view the invitation
    </div>

    <script>
        function adjustInvitationSize() {
            const invitationEntity = document.getElementById('invitation-entity');
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            // Significantly reduced size - now 25% of screen width for mobile
            const targetWidth = screenWidth * 0.25;
            // Using actual invitation aspect ratio (width:height = 3:2)
            const aspectRatio = 1.5;
            
            // Convert to AR units with much smaller scale
            const arWidth = (targetWidth / 2000); // Doubled the divisor for smaller size
            const arHeight = arWidth / aspectRatio;

            // Update entity geometry
            invitationEntity.setAttribute('geometry', {
                primitive: 'plane',
                width: arWidth,
                height: arHeight
            });

            // Move closer to camera for better visibility
            invitationEntity.setAttribute('position', {
                x: 0,
                y: 0,
                z: -0.5 // Closer to camera
            });
        }

        // Initial size adjustment
        window.addEventListener('load', adjustInvitationSize);
        
        // Adjust size when screen is resized or orientation changes
        window.addEventListener('resize', adjustInvitationSize);
        window.addEventListener('orientationchange', adjustInvitationSize);

        document.querySelector('a-scene').addEventListener('loaded', function () {
            document.getElementById('loading-screen').style.display = 'none';
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                document.getElementById('mobile-instructions').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('mobile-instructions').style.display = 'none';
                }, 5000);
                adjustInvitationSize();
            }
        });

        document.querySelector('a-entity').addEventListener('materialtextureloaded', function() {
            console.log('Image texture loaded successfully');
            adjustInvitationSize();
        });

        document.querySelector('a-entity').addEventListener('error', function(e) {
            console.error('Error loading image:', e);
        });
    </script>
</body>
</html>
